---
title: "review"
author: "Azul Carrillo"
date: "2022-11-29"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

```
#1 Write a conditional statement that checks if surveys.csv exists in the working directory, if it doesn’t then downloads it from https://ndownloader.figshare.com/files/2292172 using download.file(), and finally loads the file into a data frame and displays the first few rows using the head() function. The url needs to be in quotes since it is character data.
```{r}
getwd()
"surveys.csv" == c(list.files("/Users/atziri/Bio 195-197/Data Science/raw-data"))

surveys <- list.files("/Users/atziri/Bio 195-197/Data Science/raw-data") == "surveys.csv"


is.element("surveys.csv", list.files("/Users/atziri/Bio 195-197/Data Science/raw-data") )
```

```{r}
```

```{r}
is.element("surveys.csv", list.files("/Users/atziri/Bio 195-197/Data Science/raw-data") )

```

```{r}

surveys <- list.files("../raw-data")

if (is.element("surveys.csv", surveys)){
  print("file is downloaded")
} else {
   print("file is not downloaded") 
  download.file("https://ndownloader.figshare.com/files/2292172",
              "../raw-data/surveys-download.csv")
surveys_data <- read.csv("../raw-data/surveys-download.csv")
 head(surveys_data)
}


```
#2 Make a version of this conditional statement that is a function, where the name of the file is the first argument and the link for downloading the file is the second argumen
```{r}
#This function tests if a file is in the raw-data directory and if not it download it and read it as data frame with the read, csv function:

reading_csv <- function(file_name, file_link) {

# 1. test if file_name is in the raw-data folder
# file_name <- "species.csv"
  
test <- !is.element(file_name, list.files(path = "../raw-data"))

# 2. if test is FALSE, download the file

if (test) {
  # Option 1: save it with a random name:
  # download.file(url = file_link, destfile = "../raw-data/temporary.csv")
  
  # result <- read.csv(file = "../raw-data/temporary.csv")

# Option 2: save it with the name given in file nome:
  destination_file <- stringr::str_c("../raw-data/", file_name) 
  download.file(url = file_link, destfile = destination_file)
  result <- read.csv(file = destination_file)
}
  return(result)
}
```

```{r}

reading_csv <- function(file_name, file_link) {
  test <- is.element(file_name, list.files(path = "../raw-data"))# removed the exclamation mark for it to show the table when i already have a species file downloaded 
  if (test) {
    destination_file <- stringr:: str_c("../raw-data/", file_name) 
    download.file(url = file_link, destfile = destination_file)
    
    result <- read.csv(file = destination_file)
  }
   return(result)
}
```

```{r}
reading_csv(file_name = "species.csv", 
            file_link = "https://ndownloade.figshare.com/files/3299483")
```
#Exercise 2: Multi-file Analysis

##1. If individual_collar_data.zip is not already in your working directory download the zip file using download.file()

##2. Unzip it using unzip()

##3. Obtain a list of all of the files with file names matching the pattern "collar-data-.*.txt" (using list.files())

```{r}
library(dplyr)
library(ggplot2)
collar_data_files <- list.files(pattern = "collar-")
collar_data_files
```

##4. Use a loop to load each of these files into R and make a line plot (using geom_path()) for each file with long on the x axis and lat on the y axis. Graphs, like other types of output, won’t display inside a loop unless you explicitly display them, so you need put your ggplot() command inside a print() statement. Include the name of the file in the graph as the graph title using labs().

##5. Add code to the loop to calculate the minimum and maximum latitude in the file, and store these values, along with the name of the file, in a data frame. Show the data frame as output.
```{r}
min_results <- vector(mode = "integer", length(collar_data_files)) 
max_results <- vector(mode = "integer", length(collar_data_files)) 


for(i in 1:length(collar_data_files)){
  filename <- collar_data_files[i]
  data <- read.csv(filename) 
  data %>%
    ggplot(aes(x = long, y = lat )) +
    labs(title = filename) +
  geom_path() -> plots
    print(plots) 
   min_results[i] <- min(data$lat)
   max_results[i] <- max(data$lat)
}

```

#Exercise 3: A function for the UHURU data set


##1. Explain what each line of code in the body of the function is doing. Add the explanations to your Rmd file as comments, before each line of code.

```{r}

report_rsquared <- function(data, species, formula){
  subset <- dplyr::filter(data, ANT == species)
  test <- lm(formula, data = subset)
  rsquared <- round(summary(test)$r.squared, 3)
  output <- data.frame(species = species, r2 = rsquared)
  return(output)
}
```

##2. Execute the function using the UHURU data and specifying species = "CM" and formula = "AXIS1~CIRC".
```{r}
UHURU_data <- read.csv(file = "../raw-data/ACACIA_DREPANOLOBIUM_SURVEY.txt", sep = "\t")

report_rsquared(UHURU_data,"CM","AXIS1~CIRC")
```

##3. Modify the function so that it also determines if() the rsquared is significant based on a given threshold. The modified function should return() the species, rsquared and a significance value of "S" for a relationship with an rsquared > threshold or "NS" for an rsquared < threshold.
```{r}
report_rsquared_modified <- function(data, species, formula){
  subset <- dplyr::filter(data, ANT == species)
  test <- lm(formula, data = subset)
  rsquared <- round(summary(test)$r.squared, 3)
  output <- data.frame(species = species, r2 = rsquared)
  return(output)
}
```

##4. Execute your modified function for species of "CM", "CS", and "TP" given a threshold = 0.667.
```{r}
```

```{r}
```















